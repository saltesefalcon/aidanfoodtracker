<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Food Transfer Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Required Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/xlsx.mjs" type="module"></script>

  <style>
    body { font-family: Arial; padding: 20px; max-width: 700px; margin: auto; background: #f8f8f8; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input, select, button {
      width: 100%; padding: 10px; margin: 5px 0 15px; font-size: 1rem;
      border: 1px solid #ccc; border-radius: 5px;
    }
    button { background: #007bff; color: white; cursor: pointer; }
    button:hover { background: #0056b3; }
    h1, h2, h3 { text-align: center; }
    .log-entry {
      background: white; border: 1px solid #ddd; border-radius: 6px;
      padding: 10px; margin-bottom: 10px;
    }
    .log-controls { margin-top: 10px; display: flex; gap: 10px; justify-content: space-between; }
  </style>
</head>
<body>
  <h1>Food Transfer Tracker</h1>

  <label>Date:</label>
  <input type="date" id="date">

  <label>From:</label>
  <select id="from"></select>

  <label>To:</label>
  <select id="to"></select>

  <label>Product:</label>
  <input id="product">

  <label>Amount:</label>
  <input type="number" id="amount">

  <label>Unit:</label>
  <select id="unit" onchange="document.getElementById('cost-label').textContent = 'Cost per ' + this.value + ':'"></select>

  <label id="cost-label">Cost per unit:</label>
  <input type="number" id="cost" placeholder="$">

  <label>Comment:</label>
  <input id="comment" placeholder="Optional">

  <button onclick="addTransfer()">Submit Transfer</button>

  <h2>Logs for <button onclick="changeMonth(-1)">&lt;</button> <span id="current-month"></span> <button onclick="changeMonth(1)">&gt;</button></h2>
  <div id="logs"></div>
  <button onclick="exportMonthlyReport()">Monthly Report</button>

  <script type="module">
    import * as XLSX from "https://cdn.sheetjs.com/xlsx-0.20.0/package/xlsx.mjs";

    const firebaseConfig = {
      apiKey: "AIzaSyAdWAxKfSLI7jf7vJSwrIXogvL3LRW-GFU",
      authDomain: "aidan-food-tracker.firebaseapp.com",
      projectId: "aidan-food-tracker",
      storageBucket: "aidan-food-tracker.appspot.com",
      messagingSenderId: "397728832351",
      appId: "1:397728832351:web:33645f7f37ee1f277ff4ea",
      databaseURL: "https://aidan-food-tracker-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const locations = ["Prohibition", "Tulia Osteria", "Ce Soir", "Beacon"];
    const locationEmails = {
      "Prohibition": "accounts@prohibitionsocialhouse.com",
      "Beacon": "accounts@beaconsocialhouse.com",
      "Tulia Osteria": "accounts@tuliaosteria.com",
      "Ce Soir": "accounts@cesoirbrasserie.com"
    };
    const units = ["oz", "lb", "kg", "fl oz", "ml", "L"];
    let selectedMonth = new Date().toISOString().slice(0, 7);

    function $(id) { return document.getElementById(id); }

    function setupUI() {
      locations.forEach(loc => {
        ["from", "to"].forEach(id => {
          const opt = document.createElement("option");
          opt.value = opt.textContent = loc;
          $(id).appendChild(opt);
        });
      });
      units.forEach(unit => {
        const opt = document.createElement("option");
        opt.value = opt.textContent = unit;
        $("unit").appendChild(opt);
      });
    }

    function updateMonthDisplay() {
      $("current-month").textContent = selectedMonth;
    }

    function getUniqueInvoiceNumber() {
      return 'INV' + Date.now();
    }

    function addTransfer() {
      const date = $("date").value;
      const from = $("from").value;
      const to = $("to").value;
      const product = $("product").value;
      const amount = parseFloat($("amount").value);
      const unit = $("unit").value;
      const costPerUnit = parseFloat($("cost").value) || null;
      const comment = $("comment").value || "";

      if (!date || !from || !to || !product || isNaN(amount) || !unit || from === to) {
        alert("Please complete all required fields and make sure 'from' and 'to' are different.");
        return;
      }

      const monthKey = date.slice(0, 7);
      const sharedId = Date.now();
      const invoiceNumber = getUniqueInvoiceNumber();
      const log = { date, from, to, product, amount, unit, costPerUnit, comment, sharedId, invoiceSent: false, invoiceNumber };

      db.ref(`logs/${from}/${monthKey}/${sharedId}`).set(log);
      db.ref(`logs/${to}/${monthKey}/${sharedId}`).set(log);

      loadLogs();
    }

    // rest of code remains unchanged...
  </script>
</body>
</html>



